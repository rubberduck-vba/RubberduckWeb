define(["jquery","common/regexhelper/regexhelper","common/api/api.guid","libs/jquery/plugins/jquery.xDomainRequest"],function(e,s,i){function t(t,n,a,o,r){var l,u,m,c,d,h,p,v,f=this,g="form-button-disabled",b="form-value-invalid";this.cacheSelectors=function(){u=e("div#"+n),l=e("div#"+t),m=l.find('input[type="submit"]'),c=l.find('input[name="name"]'),d=l.find('input[name="email"]'),h=l.find('input[name="subject"]'),p=l.find('textarea[name="message"]'),v=l.find('input[name="opt-in"]')},this.isMobileView=function(){{var s="#mobile-site-view";e(s)}return e(s).length>0},this.hideSuccessMessage=function(){u.hide()},this.showSuccessMessage=function(){u.show(),u.parent().css("overflow","auto")},this.hideForm=function(){l.children(".form-body").hide()},this.showForm=function(){l.show()},this.wireUpClickEvent=function(){m.click(f.onSubmitClick)},this.removeInvalidCssFromInputs=function(){c.removeClass(b),d.removeClass(b),h.removeClass(b),p.removeClass(b)},this.addInvalidCssToInput=function(e){var s;switch(e){case"message":s=p;break;case"name":s=c;break;case"email":s=d;break;case"subject":s=h}s&&s.addClass(b)},this.getCurrentFormValues=function(){return{name:e.trim(c.val()),email:e.trim(d.val()),subject:e.trim(h.val()),message:e.trim(p.val()),optIn:v.is(":checked")}},this.validateFormValues=function(e){var i=!0;return 0===e.name.length&&(i=!1,f.addInvalidCssToInput("name")),0===e.email.length?(i=!1,f.addInvalidCssToInput("email")):s.validateEmailAddress(e.email)||(i=!1,f.addInvalidCssToInput("email")),0===e.subject.length&&(i=!1,f.addInvalidCssToInput("subject")),0===e.message.length&&(i=!1,f.addInvalidCssToInput("message")),i},this.isButtonDisabled=function(){return m.hasClass(g)},this.toPascalCase=function(e){return null!=e&&void 0!=e&&(e=e.replace(/\w\S*/g,function(e){return e[0].toUpperCase()+e.slice(1).toLowerCase()})),e},this.sendFormPost=function(s){var t=[],n={name:"input",email:"email",subject:"input",message:"paragraph",optIn:"checkbox"};e.each(s,function(e,s){null!=n[e]&&t.push({label:f.toPascalCase(e),value:s,type:n[e]})});var a={domainName:r.domainName,resellerId:r.resellerId,elementId:i.toLegacyIdString(r.elementId),subject:r.subject,emailHashList:r.emailHashList,formFields:t,hostPageUrl:encodeURIComponent(window.location.href)},o=r.mailerUrl,l={type:"POST",url:o,crossDomain:!0,data:JSON.stringify(a),dataType:"json"},u=!0;s.optIn&&(u=!1);var m=(s.name||"").split(" "),c=m[0],d=m.slice(1).join(" "),h={email:s.email,first_name:c,last_name:d,suppressed:u},p=[r.gemSubmitUrl,r.shopperId,r.domainName].join("/"),v={type:"POST",url:p,crossDomain:!0,data:h,dataType:"json"};e.when(e.ajax(l),e.ajax(v)).then(f.onSubmitSuccess).fail(f.onSubmitFailure)},this.setWindowLocation=function(e){window.location=e},this.onLoad=function(){f.cacheSelectors(),f.hideSuccessMessage(),f.showForm(),f.wireUpClickEvent()},this.onSubmitClick=function(){f.removeInvalidCssFromInputs();var e=f.getCurrentFormValues();f.validateFormValues(e)&&(f.isButtonDisabled()||(m.addClass(g),f.sendFormPost(e)))},this.onSubmitSuccess=function(){0===a?(f.hideForm(),f.showSuccessMessage()):f.setWindowLocation(o)},this.onSubmitFailure=function(s){m.removeClass(g);var i=r.sendErrorMessage,t=r.errorTitle,n="error";429===s.status&&r.tooManyRequestsErrorMessage&&(i=r.tooManyRequestsErrorMessage,r.tooManyRequestsErrorTitle&&(t=r.tooManyRequestsErrorTitle),n="warning"),f.isMobileView()?alert(i):e("<div></div>").sfGrowl({title:t||"",content:i,icon:n,fadetime:3e3})},this.init=function(){e(document).ready(f.onLoad)}}return t});
//# sourceMappingURL=form.js.map